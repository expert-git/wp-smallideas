jQuery(function(e){var i=CodeMirror.fromTextArea(e("#custom-css-textarea").get(0),{tabSize:2,mode:"css",theme:"neat",gutters:["CodeMirror-lint-markers"],lint:!0,extraKeys:{Tab:function(e){var i=Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(i)}}});e("#custom-css-container").css("overflow","visible"),e("#so-custom-css-info a").click(function(i){confirm(e(this).closest("ol").data("confirm"))||i.preventDefault()}),e("#css-insert-snippet").click(function(i){i.preventDefault();e(this).blur();s()});var t=e("#snippet-browser"),s=function(){var e=t.find(".snippets li.snippet.active");0===e.length?(t.find(".snippet-view").hide(),t.find("#so-insert-snippet").attr("disabled","disabled")):(t.find(".snippet-view").show(),t.find("#so-insert-snippet").removeAttr("disabled")),t.find("#snippet-search").val("").keyup(),t.show()};t.find(".toolbar .close").click(function(e){e.preventDefault(),t.hide()}),t.find(".snippets li.snippet").click(function(){var i=e(this);t.find(".snippets li.snippet").removeClass("active"),i.addClass("active"),t.find("#so-insert-snippet").removeAttr("disabled");var s=t.find(".main .snippet-view");s.find(".snippet-title").html(i.html()),s.find(".snippet-description").html(i.data("description")),s.find(".snippet-code").html(i.data("code")),t.find(".snippet-view").show()}),t.find("#so-insert-snippet").click(function(){var e=t.find(".snippets li.snippet.active"),s=e.data("code");t.hide();var n="";n=1===i.doc.lineCount()&&0===i.doc.getLine(i.doc.lastLine()).length?"":0===i.doc.getLine(i.doc.lastLine()).length?"\n":"\n\n",i.doc.setCursor(i.doc.lastLine(),i.doc.getLine(i.doc.lastLine()).length),i.doc.replaceSelection(n+s)}),t.find("#snippet-search").keyup(function(){var i=e(this);""===i.val()?t.find(".snippets li.snippet").show():t.find(".snippets li.snippet").each(function(){var t=e(this),s=i.val().toLowerCase();-1!==t.html().toLowerCase().indexOf(s)||-1!==t.data("description").toLowerCase().indexOf(s)?t.show():t.hide()})}),e("#css-editor-expand").click(function(t){t.preventDefault();var s=e(this);s.blur();var n=e("#so-custom-css-form");if(n.toggleClass("expanded"),n.hasClass("expanded")){e("body").css("overflow","hidden");var o=e("#custom-css-preview iframe");o.data("home")&&(o.attr("src",o.data("home")),o.data("home",!1)),e(window).resize()}else i.setSize("100%","auto"),e("body").css("overflow","visible")}),e(window).resize(function(){e("#so-custom-css-form").hasClass("expanded")&&i.setSize("100%",e(window).outerHeight()-e("#custom-css-toolbar").outerHeight())});var n,o=function(){var t=e("#custom-css-preview iframe");if(t.is(":visible")){var s=t.contents().find("head");0===s.find("style.siteorigin-custom-css").length&&s.append('<style class="siteorigin-custom-css" type="text/css"></style>');var o=s.find("style.siteorigin-custom-css");clearTimeout(n),n=setTimeout(function(){var e=i.getValue();o.html(e)},75)}};i.on("change",function(e,i){o()}),e("#custom-css-preview iframe").load(function(){var i=e(this);i.contents().find("a").each(function(){var i=e(this).attr("href");if(i){var t=-1===i.indexOf("?")?"?":"&";e(this).attr("href",i+t+"so_css_preview=1")}}),o()}),e("#upgrade-notice .dismiss").click(function(i){i.preventDefault(),e.get(e(this).attr("href")),e("#upgrade-notice").slideUp()})});